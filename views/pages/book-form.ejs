<!-- filepath: views/pages/book-form.ejs -->
<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card">
        <div class="card-header">
          <h3><%= action === 'edit' ? 'Editar Livro' : 'Adicionar Novo Livro' %></h3>
        </div>
        <div class="card-body">
          <form action="<%= action === 'edit' ? '/books/' + book._id + '?_method=PUT' : '/books/create' %>" method="POST" enctype="multipart/form-data">
            
            <!-- Informações Básicas -->
            <div class="row">
              <div class="col-md-6">
                <div class="form-group mb-3">
                  <label for="title" class="form-label">Título *</label>
                  <input type="text" class="form-control" id="title" name="title" required 
                         value="<%= book ? book.title : '' %>">
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group mb-3">
                  <label for="code" class="form-label">Código/ISBN</label>
                  <input type="text" class="form-control" id="code" name="code" 
                         value="<%= book ? book.code : '' %>">
                </div>
              </div>
            </div>

            <div class="form-group mb-3">
              <label for="description" class="form-label">Descrição *</label>
              <textarea class="form-control" id="description" name="description" rows="4" required><%= book ? book.description : '' %></textarea>
            </div>

            <div class="row">
              <div class="col-md-6">
                <div class="form-group mb-3">
                  <label for="author" class="form-label">Autor *</label>
                  <input type="text" class="form-control" id="author" name="author" required
                         value="<%= book ? book.author : '' %>">
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group mb-3">
                  <label for="theme" class="form-label">Tema/Categoria</label>
                  <input type="text" class="form-control" id="theme" name="theme" 
                         value="<%= book ? book.theme : '' %>">
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-4">
                <div class="form-group mb-3">
                  <label for="publishedYear" class="form-label">Ano de Publicação</label>
                  <input type="number" class="form-control" id="publishedYear" name="publishedYear" 
                         min="1900" max="2030" value="<%= book ? book.publishedYear : '' %>">
                </div>
              </div>
              <div class="col-md-4">
                <div class="form-group mb-3">
                  <label for="pages" class="form-label">Páginas</label>
                  <input type="number" class="form-control" id="pages" name="pages" min="1"
                         value="<%= book ? book.pages : '' %>">
                </div>
              </div>
              <div class="col-md-4">
                <div class="form-group mb-3">
                  <label for="language" class="form-label">Idioma</label>
                  <select class="form-control" id="language" name="language">
                    <option value="pt-BR" <%= (book && book.language === 'pt-BR') || !book ? 'selected' : '' %>>Português (BR)</option>
                    <option value="en-US" <%= book && book.language === 'en-US' ? 'selected' : '' %>>Inglês (US)</option>
                    <option value="es-ES" <%= book && book.language === 'es-ES' ? 'selected' : '' %>>Espanhol</option>
                    <option value="fr-FR" <%= book && book.language === 'fr-FR' ? 'selected' : '' %>>Francês</option>
                  </select>
                </div>
              </div>
            </div>

            <!-- Upload de Arquivos -->
            <div class="row">
              <div class="col-md-4">
                <div class="form-group mb-3">
                  <label for="coverFile" class="form-label">Capa (Imagem)</label>
                  <input type="file" class="form-control" id="coverFile" name="coverFile" accept="image/*">
                  <small class="form-text text-muted">JPG, PNG, GIF, WebP - Máx: 5MB</small>
                </div>
              </div>
              <div class="col-md-4">
                <div class="form-group mb-3">
                  <label for="pdfFile" class="form-label">Arquivo PDF</label>
                  <input type="file" class="form-control" id="pdfFile" name="pdfFile" accept=".pdf">
                  <small class="form-text text-muted">Apenas PDF - Máx: 50MB</small>
                </div>
              </div>
              <div class="col-md-4">
                <div class="form-group mb-3">
                  <label for="iconFile" class="form-label">Ícone (Opcional)</label>
                  <input type="file" class="form-control" id="iconFile" name="iconFile" accept="image/*">
                  <small class="form-text text-muted">JPG, PNG - Máx: 2MB</small>
                </div>
              </div>
            </div>

            <!-- Informações Adicionais -->
            <div class="form-group mb-3">
              <label for="sinopsis" class="form-label">Sinopse</label>
              <textarea class="form-control" id="sinopsis" name="sinopsis" rows="3"><%= book ? book.sinopsis : '' %></textarea>
            </div>

            <div class="row">
              <div class="col-md-6">
                <div class="form-group mb-3">
                  <label for="url" class="form-label">URL/Link</label>
                  <input type="url" class="form-control" id="url" name="url" 
                         value="<%= book ? book.url : '' %>">
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group mb-3">
                  <label for="repository" class="form-label">Repositório</label>
                  <input type="url" class="form-control" id="repository" name="repository" 
                         value="<%= book ? book.repository : '' %>">
                </div>
              </div>
            </div>

            <div class="form-group mb-3">
              <label for="tags" class="form-label">Tags (separadas por vírgula)</label>
              <input type="text" class="form-control" id="tags" name="tags" 
                     value="<%= book && book.tags ? book.tags.join(', ') : '' %>"
                     placeholder="Ex: UML, Modelagem, Programação">
            </div>

            <div class="form-group mb-3">
              <label for="documentations" class="form-label">Documentações (separadas por vírgula)</label>
              <input type="text" class="form-control" id="documentations" name="documentations" 
                     value="<%= book && book.documentations ? book.documentations.join(', ') : '' %>"
                     placeholder="Ex: Manual, Guia de instalação">
            </div>

            <!-- Opções -->
            <div class="row">
              <div class="col-md-6">
                <div class="form-check mb-3">
                  <input type="checkbox" class="form-check-input" id="status" name="status" 
                         <%= (book && book.status) || !book ? 'checked' : '' %>>
                  <label class="form-check-label" for="status">Ativo/Disponível</label>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-check mb-3">
                  <input type="checkbox" class="form-check-input" id="isActive" name="isActive" 
                         <%= (book && book.isActive) || !book ? 'checked' : '' %>>
                  <label class="form-check-label" for="isActive">Visível no catálogo</label>
                </div>
              </div>
            </div>

            <!-- Botões -->
            <div class="form-group text-end">
              <a href="/books" class="btn btn-secondary me-2">Cancelar</a>
              <button type="submit" class="btn btn-primary">
                <%= action === 'edit' ? 'Atualizar' : 'Criar' %> Livro
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// Validação no frontend
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('form');
    
    form.addEventListener('submit', function(e) {
        const title = document.getElementById('title').value.trim();
        const description = document.getElementById('description').value.trim();
        const author = document.getElementById('author').value.trim();
        
        if (!title || !description || !author) {
            e.preventDefault();
            alert('Por favor, preencha todos os campos obrigatórios (Título, Descrição, Autor).');
            return false;
        }
        
        // Validar tamanho dos arquivos
        const coverFile = document.getElementById('coverFile').files[0];
        const pdfFile = document.getElementById('pdfFile').files[0];
        const iconFile = document.getElementById('iconFile').files[0];
        
        if (coverFile && coverFile.size > 5 * 1024 * 1024) {
            e.preventDefault();
            alert('A imagem da capa deve ter no máximo 5MB.');
            return false;
        }
        
        if (pdfFile && pdfFile.size > 50 * 1024 * 1024) {
            e.preventDefault();
            alert('O arquivo PDF deve ter no máximo 50MB.');
            return false;
        }
        
        if (iconFile && iconFile.size > 2 * 1024 * 1024) {
            e.preventDefault();
            alert('O ícone deve ter no máximo 2MB.');
            return false;
        }
    });
});
</script>